# 为调度任务编写 Cron 表达式

> 原文:[https://www . geesforgeks . org/writing-cron-expressions-for-scheduling-tasks/](https://www.geeksforgeeks.org/writing-cron-expressions-for-scheduling-tasks/)

[Cron](https://www.geeksforgeeks.org/crontab-in-linux-with-examples/) 是一个广泛使用的软件工具，可在类似 Unix 的操作系统上使用，用于作业调度。某些可能需要偶尔运行的程序或脚本被添加为 Cron 作业，并定义了一个时间表来描述何时运行该作业。Cron 表达式提供了一种指定该计划的方法。此外，Cron 表达式广泛用于不同的应用程序和库，以表达复杂的基于时间的计划，用于各种目的。

**Cron 计划示例:**
Cron 表达式旨在指定计划任务必须执行的日期和时间。使用 Cron 表达式，我们可以指定如下计划。

*   每一分钟每一小时跑一次。
*   每小时跑一次，从每小时 15 分钟开始。
*   每小时运行一次，凌晨 02:00 到 05:00 之间的时间除外

上面的列表提供了一个非常基本的计划列表，可以使用单个 cron 表达式编写。
**Cron 表达式格式:**
Cron 表达式是由 6 到 7 个字段组成的简单字符串，每个字段由空格分隔。最常见的 cron 表达式由 7 个字段组成，表示不同的时间名称，具体如下。从 7 个字段中，前 6 个是必填字段，而最后一个字段(<年>)是可选字段。

```
<seconds> <minutes> <hours> <day-of-month> <month> <day-of-week> <year>
```

基于为上述每个组件指定的值，可以创建复杂的计划。
**克朗表达式中使用的特殊字符:**

<center>

| 性格；角色；字母 | 意义 | 例子 |
| * | 全部。表示应为每个时间单位运行计划 | 分钟字段中的“*”表示计划每分钟运行一次 |
| ？ | 任何。表示任意值。这只能在月日和周日字段中使用 | 一个"？"月中的某一天字段不会使用月中的某一天来决定计划，因为任何值在这里都是可以接受的 |
| – | 范围。表示连续的值范围。 | 在<hour>字段中使用“5-8”表示小时 5、6、7 和 8</hour> |
| , | 多个值。分隔不同值的列表 | 在<hour>字段中使用“5，6，10”表示小时 5，6 和 10</hour> |
| / | 增量。指定字段值的增量 | 分钟字段中的 3/5 表示一小时中的分钟 3、8、13、…、58。分钟字段中的*/10 表示分钟 0、10、20…、60 |

</center>

**创建计划:**
使用上述指定的字段，可以使用值的组合来使用 Cron 表达式创建所需的计划。作为一个例子，让我们试着理解如何构造一些示例 cron 表达式。

1.  **每天上午 09:23:15 运行一次–**
    由于计划每天、每月和每年运行一次，因此这些字段将用*标记。对于星期几或月几，我们必须使用“？”一个是“*”，另一个是“*”(两者都不能有“？”)或“*”同时出现)。此外，小时字段将是 9，分钟字段将是 23，秒的字段将是 0。因此表达式是 0 9 23 * *？*.
2.  **每天从下午 06:00 开始，到晚上 10:00 结束，每分钟运行一次–**
    时间表必须在每分钟开始时运行，即每分钟第二个 0。因此，第二个字段是 0，分钟字段是*。时间范围从下午 06:00 到晚上 10:00。这可以表示为 18-22，因为小时是在 0-23 的范围内解析的。因此，表达式为:0 * 18-22 * *？*.
3.  **从每天下午 04:00 开始到下午 04:55 结束每 5 分钟运行一次–**
    要每 5 分钟运行一次计划，小时字段中使用的增量为 5，如下所示 *0/5。*对于小时字段，由于计划将仅在下午 04:00 的小时内运行，因此要使用的值仅为 16。因此，表达式是:0 0/5 16 * *？。

**理解克隆表达:**
以下是克隆表达的进一步例子及其含义:

<center>

| 表示 | 意义 |
| ***0 */5 *？* ***T3】* | 每五分钟一次 |
| ***0 20、30、45 *？* ***T3】* | 每小时 20、30 和 45 分钟(因此每小时三次) |
| ***0 30、45 14？1-5 日星期一**T3* | 在 1 月至 5 月(1-5 日)的每个星期一下午 2:30 和 2:45 |
| ***0 0 9？* MON-FRI*** | 从周一到周五每天早上 09:00 |
| ***15 30 *？* ***T3】* | 每小时 30 分钟的第 15 秒。例如 10:30:15，11:30:15，… |
| ***25 30 10 * *？2021**T3* | 2021 年每天上午 10:30:25 |
| ***0 20 8？* 3L 2020-2022*** | 2020 年、2021 年和 2022 年每个月的最后一个星期二上午 08:20 |

</center>

**在 Unix 中使用带有命令的 Cron 表达式:**
在 Unix 中，shell 命令列表以及执行时间表可以由 crontab(cron 表)指定。crontab 条目的语法是计划表达式+要运行的 shell 命令。因此，格式如下。

```
<seconds> <minutes> <hours> <day-of-month> <month> <day-of-week> <year> <shell-command>
```

**示例–**
例如，以下 crontab 条目在每周六 22:30(晚上 10:30)执行名为 *clear_logs.sh* 的 shell 程序。

```
0 30 22 ? * SAT /home/scripts/clear_logs.sh
```

**关于使用 Cron 表达式的注意事项:**

*   在同一个 cron 表达式中，不能用相同的值同时指定月日和周日字段。如果两个值中的一个用 ******* 来表示，那么另一个一定要用 ***来表示吗？***
*   将计划时间设置在上午 12:00 到 1:00 之间时，与夏令时相关的更改可能会导致跳过或重复计划的激发。
*   如果需要，表达式可能已经分成 2。例如，要表示除了凌晨 03:00 和 06:00 之间每分钟触发一次的计划，需要以下两个表达式: **0 * 0-2 * *？**每分钟运行一次时间表，在上午 12:00 到 03:59 之间，另一个表达式 **0 * 6-23 * *？**每分钟运行一次，时间在早上 06:00 到晚上 11:59 之间。