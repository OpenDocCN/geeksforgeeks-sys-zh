# 测量上下文切换花费的时间？

> 原文:[https://www . geesforgeks . org/measure-time-wasted-context-switch/](https://www.geeksforgeeks.org/measure-time-spent-context-switch/)

*上下文切换*是两个进程之间花费的时间(即，使等待进程进入执行状态，并使正在执行的进程进入等待状态)。这发生在多任务处理中。如果等待进程，操作系统必须将状态信息带入内存，并保存当前运行进程的状态信息。

为了解决这个问题，我们希望记录交换过程的第一个和最后一个指令的时间戳。上下文切换时间是两个进程之间的差异。

**举个例子:**假设只有两个过程，P1 和 P2。
P1 在行刑，P2 在等待行刑。在某些时候，操作系统必须交换 P1 和 P2，让我们假设它发生在 P1 的第 n 次指令。如果 t(x，k)表示进程 x 的第 k 条指令的时间戳(以微秒计)，那么上下文切换将采用 t(2，1)–t(1，n)。

另一个问题是交换由操作系统的调度算法控制，并且可能有许多内核级线程也在进行上下文切换。其他进程可能会争夺处理中断的中央处理器或内核。用户无法控制这些无关的上下文切换。例如，如果在时间 t(1，n)内核决定处理一个中断，那么上下文切换时间将被夸大。

为了避免这些障碍，我们必须构建一个环境，使得在 P1 执行之后，任务调度器立即选择 P2 运行。这可以通过构建数据通道来实现，例如 P1 和 P2 之间的管道。

也就是说，让我们允许 P1 作为最初的发送者，P2 作为接收者。最初，P2 在等待数据令牌时被阻止(休眠)。当 P1 执行时，它通过数据通道将数据令牌传递给 P2，并立即尝试读取响应令牌。将产生上下文切换，任务计划程序必须选择另一个进程来运行。由于 P2 现在处于准备运行状态，因此它是由任务调度器选择执行的理想候选。当 P2 竞选时，P1 和 P2 的角色互换了。P2 现在是发送方，P1 是被阻止的接收方。

**至总结–**

1.  P2 封锁等待来自 P1 的数据
2.  P1 标志着开始时间。
3.  P1 向 P2 送去一个信物。
4.  P1 试图读取来自 P2 的响应令牌。这导致了上下文切换。
5.  P2 被安排好并收到了令牌。
6.  P2 向 P1 发送了一个响应令牌。
7.  P2 试图读取来自 P1 的响应令牌。这导致了上下文切换。
8.  P1 被安排好并收到了令牌。
9.  P1 标志着结束时间。

关键是数据令牌的传递会引发上下文切换。让 Td 和 Tr 分别是传递和接收数据令牌所花费的时间，让 Tc 是在上下文切换中花费的时间。在第 2 步，P1 记录令牌传递的时间戳，在第 9 步，它记录响应的时间戳。这些事件之间经过的时间量 T 可以表示为:

```
 T = 2 * (Td + Tc + Tr)
```

**这个公式是因为以下事件产生的:**

*   P1 发送令牌(3)
*   中央处理器上下文开关(4)
*   P2 收到它(5)
*   然后，P2 发送响应令牌(6)
*   中央处理器上下文开关(7)
*   最后，P1 收到了

GATE CS 练习题–

*   [GATE-CS-2006 |问题 85](https://www.geeksforgeeks.org/gate-gate-cs-2006-question-6/)
*   [GATE CS 1998 |问题 52](https://www.geeksforgeeks.org/aptitude-gate-cs-1998-question-52/)