# 静态和动态库|集合 1

> 原文:[https://www.geeksforgeeks.org/static-vs-dynamic-libraries/](https://www.geeksforgeeks.org/static-vs-dynamic-libraries/)

编译 C 程序时，编译器生成目标代码。生成目标代码后，编译器还会调用链接器。链接器的主要任务之一是编写库函数(如 printf()、scanf()、sqrt()，..等等)对您的程序可用。链接器可以通过两种方式完成这项任务，一种是将库函数的代码复制到目标代码中，另一种是进行一些安排，使库函数的完整代码不被复制，而是在运行时可用。

**静态链接和静态库**是链接器将所有使用的库函数复制到可执行文件的结果。静态链接会创建更大的二进制文件，并且需要更多的磁盘和主内存空间。静态库(静态链接的库)的例子有: ***。Linux 中的一个*** 文件和 ***文件。在 Windows 中 lib*** 文件。

**创建静态库的步骤**让我们在 UNIX 或类似 OS 的 UNIX 中创建并使用一个静态库。
T3】1。在你的库中创建一个包含函数的 C 文件。

```
/* Filename: lib_mylib.c */
#include <stdio.h>
void fun(void)
{
  printf("fun() called from a static library");
}
```

为了简单起见，我们只创建了一个文件。我们还可以在一个库中创建多个文件。

**2。**为库创建头文件

```
/* Filename: lib_mylib.h */
void fun(void);
```

**3。**编译库文件。

```
 gcc -c lib_mylib.c -o lib_mylib.o 
```

**4。**创建静态库。这一步是将多个对象文件捆绑在一个静态库中(详见 [ar](http://en.wikipedia.org/wiki/Ar_(Unix)) )。这一步的输出是静态库。

```
 ar rcs lib_mylib.a lib_mylib.o 
```

**5。**现在我们的静态库已经可以使用了。此时，我们可以将 lib_mylib.a 复制到其他地方使用。出于演示目的，让我们将库保存在当前目录中。

**让我们创建一个驱动程序，使用上面创建的静态库**。
T3】1。创建主功能的 C 文件

```
/* filename: driver.c  */
#include "lib_mylib.h"
void main() 
{
  fun();
}
```

**2。**编译驱动程序。

```
gcc -c driver.c -o driver.o
```

**3。**将编译好的驱动程序链接到静态库。注意-L **。**用于告知静态库在当前文件夹中(详见[本](http://gcc.gnu.org/onlinedocs/gcc/Link-Options.html)-L 和-L 选项)。

```
gcc -o driver driver.o -L. -l_mylib
```

**4。**运行驱动程序

```
./driver 
fun() called from a static library
```

以下是关于静态库的一些要点。
**1。**对于静态库，链接器从库中提取实际代码，并在编译/构建应用程序时用于构建最终的可执行文件。

**2。**每个进程都获得自己的代码和数据副本。在动态库的情况下，只有代码共享，数据是特定于每个进程的。对于静态库，内存占用更大。例如，如果所有的窗口系统工具都是静态链接的，那么对于一个典型的用户来说，将会浪费几十兆的内存，并且用户会因为大量的分页而变慢。

**3。**由于库代码是在编译时连接的，所以最终的可执行文件在运行时不依赖于库，即没有额外的运行时加载成本，这意味着您不需要携带正在使用的库的副本，并且您可以控制一切，并且没有依赖关系。

**4。**在静态库中，一旦所有东西都捆绑到应用程序中，您就不必担心客户端的系统上会有合适的库(和版本)。

**5。**静态库的一个缺点是，对于静态库中的任何更改(升级)，每次都必须重新编译主程序。

**6。**即使在现在，静态库的一个主要优势仍然是“速度”。静态库中没有符号的动态查询。甚至在今天，许多生产线软件都使用静态库。

**动态链接和动态库**动态链接不需要复制代码，只需在二进制文件中放置库的名称即可。实际的链接发生在程序运行时，当二进制文件和库都在内存中时。动态库(运行时链接的库)的例子有: ***。所以 Linux 中的*** 和 ***。Windows 中的 dll*** 。

我们将很快介绍动态库的更多内容以及创建它们的步骤。

本文由 **Abhijit Saha** 编辑，GeeksforGeeks 团队审核。如果你发现任何不正确的地方，或者你想分享更多关于上面讨论的话题的信息，请写评论。