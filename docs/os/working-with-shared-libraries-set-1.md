# 使用共享库|集合 1

> 原文:[https://www . geesforgeks . org/work-with-shared-libraries-set-1/](https://www.geeksforgeeks.org/working-with-shared-libraries-set-1/)

这篇文章不适合那些算法极客。如果你对系统相关的东西感兴趣，请继续阅读…

共享库在共享代码方面很有用，这在许多应用程序中都很常见。例如，将所有与 TCP/IP 实现相关的代码打包在一个共享库中更经济。然而，数据不能共享，因为每个应用程序都需要自己的数据集。浏览器、ftp、telnet 等应用程序利用共享的“网络”库来提升特定功能。

每个操作系统都有自己的表示和工具集来创建共享库。这些概念或多或少是相同的。在 Windows 上，每个对象文件(*。obj，*。dll，*。ocx，*。sys，*。exe 等)遵循一种称为可移植可执行文件的格式。甚至共享库(简称为动态链接库或动态链接库)也以对等格式表示。用于创建这些库的工具集需要理解二进制格式。Linux 变体遵循一种称为可执行和可链接格式的格式。ELF 文件是独立于位置的格式。Linux 中的共享库被称为共享对象(通常带有扩展名*)。所以)。这些类似于 Windows 平台中的 dll。甚至共享对象文件也遵循 ELF 二进制格式。

请记住，文件扩展名(*。dll，*。所以，*。a*。lib 等…)只是为了方便程序员。它们没有任何意义。这些都是二进制文件。你想叫什么就叫什么。但是确保您在构建应用程序时提供了绝对路径。

一般来说，当我们编译一个应用程序时，步骤很简单。编译、链接和加载。然而，这并不简单。这些步骤在现代操作系统上更加通用。

当您将应用程序与静态库链接时，代码就是应用程序的一部分。没有依赖性。即使它导致应用程序大小增加，它也有自己的优势。最主要的是速度，因为运行时没有符号(程序实体)分辨率。因为每段代码都是二进制映像的一部分，所以这样的应用程序与版本不匹配问题无关。然而，代价是修复库代码中的一个问题。如果库代码中有任何错误，整个应用程序需要重新编译并发送到客户端。对于动态库，修复或升级库很容易。您只需要发送更新的共享库。应用程序不需要重新编译，只需要重新运行。您可以设计一种机制，我们不需要重启应用程序。

当我们根据共享库链接应用程序时，链接器会留下一些存根(未解析的符号)在应用程序加载时填充。这些存根需要在运行时或应用程序加载时由名为*动态链接器*的工具填充。同样，库的加载有两种类型，静态加载和动态加载。不要混淆 ***静态加载*** vs ***静态链接*** 和 ***动态加载*** vs ***动态链接*** 。

例如，您已经构建了一个依赖于 *libstdc++的应用程序。所以*哪个是共享对象(动态库)。应用程序如何知道所需的共享库？(如果有兴趣，可以从 Borland 工具集中探索工具 *tdump* ， *objdump* 或 *nm* 或 *readelf* 工具在 Linux 上)。

静载荷:

*   在静态加载中，所有这些相关的共享库甚至在应用程序开始执行之前就被加载到内存中。如果加载任何共享库失败，应用程序将无法运行。
*   动态加载器检查应用程序对共享库的依赖。如果这些库已经加载到内存中，库地址空间将映射到应用程序虚拟地址空间(VAS)，动态链接器将重新定位未解析的符号。
*   如果这些库没有加载到内存中(也许您的应用程序可能是第一个调用共享库的应用程序)，加载程序会搜索标准库路径并将它们加载到内存中，然后映射并解析符号。同样，加载是一个很大的过程，如果你有兴趣，可以自己编写加载器:)。
*   解析符号时，如果动态链接器找不到任何符号(可能是由于共享库的旧版本)，应用程序将无法启动。

动态加载:

*   顾名思义，动态加载就是按需加载库。
*   例如，如果您想要共享库中的一个小功能。为什么要在应用程序加载时加载它并放在内存中？当您需要这些共享库的功能时，可以动态调用它们的加载。这被称为动态加载。在这种情况下，程序员知道“库应该在什么时候被加载”的情况。工具集和相关内核提供了支持动态加载和查询共享库中符号的应用编程接口。

更多细节在后面的文章中。

*注意:如果你遇到像可加载模块这样的术语或者等价术语，不要把它们和共享库混在一起。它们不同于共享库内核提供支持可加载模块的框架。*

[**使用共享库|第 2 集**](https://www.geeksforgeeks.org/working-with-shared-libraries-set-2/)

**运动:**

1.假设您已经理解了这些概念，您如何设计一个可以升级到新的共享库而无需重新运行该应用程序的应用程序(例如银行业务)。

——[**文基**](http://www.linkedin.com/in/ramanawithu) 。如果你发现任何不正确的地方，或者你想分享更多关于上面讨论的话题的信息，请写评论。