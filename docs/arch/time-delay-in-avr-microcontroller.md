# AVR 微控制器中的时间延迟

> 原文:[https://www . geesforgeks . org/time-delay-in-AVR-microcontroller/](https://www.geeksforgeeks.org/time-delay-in-avr-microcontroller/)

在本文中，我们将看到如何为 AVR 创建延迟。此外，我们将讨论指令流水线。

**AVR 的延迟计算:**
在汇编语言指令中，要创建时间延迟，必须考虑两个重要因素。

1.  **晶体频率–**
    连接到 XTAL1 和 XTAL2 的晶体振荡器的频率是计算时间延迟的一个因素。指令周期的时钟周期持续时间是该晶体频率的函数。
2.  **AVR 设计–**
    AVR 微处理器能够在一个周期内执行一条指令。这样做有三种方法。

1.  使用哈佛架构将最大数量的代码和数据输入到中央处理器中。
2.  使用 RISC 架构特性，如固定大小的指令。
3.  使用流水线来重叠指令的获取和执行。

**流水线操作:**
在早期的微处理器中，CPU 可以在给定的时间取指令或执行指令。换句话说，中央处理器必须从内存中取出一条指令，然后执行它，然后再次取出下一条指令，执行它，依此类推。流水线允许中央处理器同时获取和执行给定的指令。

我们可以使用流水线来加速指令的执行。在管道中，执行过程被分成更小的步骤，这些步骤都是并行执行的。在执行指令时，我们必须确保指令的顺序保持不变，并且没有不同的执行。

**AVR 的指令周期时间:**
CPU 执行一条指令需要一定的时间。这个时间被称为机器周期。AVR 中的所有指令都是 2 字节或 4 字节的，因此大多数指令执行不超过 2 个机器周期(有些指令可能需要 3 到 4 个机器周期才能执行)。在自动电压调节器系列中，机器周期的持续时间取决于连接到自动电压调节器系统的振荡器的频率。在自动电压调节器中，一个机器周期由一个振荡器周期组成，这意味着每个振荡器时钟经过一个机器周期。因此，为了计算自动电压调节器的机器周期，我们取晶体频率的倒数。

**示例-1 :**
对于给定的晶体频率，计算指令周期的周期。

```
a) 8 MHz    b) 16 MHz

Solution : a) instruction cycle = 1/ 8 MHz = 0.125 us (microsecond)   
           b) instruction cycle = 1/ 16 MHz = 0.0625 us
```

**不同指令所需的指令周期(考虑 1 MHz 为晶振频率):**

| 指令 | 指令周期 | 执行时间 |
| LDI | one | 1 个美国 |
| 数位计算设备公司(Digital Equipment Corporation) | one | 1 个美国 |
| 在外 | one | 1 个美国 |
| 注意缺陷障碍 (Attention Deficit Disorder) | one | 1 个美国 |
| nototherwiseprovided（for）除非另有规定 | one | 1 个美国 |
| JMP | three | 3 美国 |
| 呼叫 | four | 4 美国 |
| 布尔诺 | 2/1 | 如果被拿走 2 美元，如果失败 1 美元 |

**示例-2 :**
如果晶振频率为 10 MHz，请找出下面代码片段在 us 中的延迟。

```
                                          Instruction Cycles
DELAY :   LDI        COUNT, 0XFF                  0
Again :   NOP                                     1          
          NOP                                     1
          NOP                                     1
          DEC        COUNT                        1
          BRNE       AGAIN                       2/1
          RET                                     4

Solution :  Time Delay = [1 +(( 1+ 1+ 1+ 1 + 2 ) x 255) + 4 ] x 0.1 us = 153.5 us

```