# 中断和异常

> 原文:[https://www.geeksforgeeks.org/interrupts-and-exceptions/](https://www.geeksforgeeks.org/interrupts-and-exceptions/)

**异常和中断**是会中断正常指令执行流程(当前由处理器执行)的意外事件。异常是处理器内部的意外事件。[中断](https://www.geeksforgeeks.org/interrupts/)是流程外的意外事件。

每当出现异常或中断时，硬件都会开始执行代码，以执行响应异常的操作。该操作可能涉及终止进程、输出错误消息、与外部设备通信，或者通过启动“死亡蓝屏”并停止中央处理器来可怕地崩溃整个计算机系统。负责此操作的指令驻留在操作系统内核中，执行此操作的代码称为中断处理程序代码。现在，我们可以把处理程序代码看作一个操作系统子程序。然后，在处理程序代码被执行之后，有可能在发生执行或中断的指令之后继续执行。

**异常和中断处理:**
每当发生异常或中断时，执行从用户模式转换到内核模式，在内核模式下处理异常或中断。具体来说，必须采取以下步骤来处理异常或中断。

进入内核时，当前执行进程的上下文(所有 CPU 寄存器的值)必须先保存到内存中。内核现在已经准备好处理异常/中断。

1.  确定异常/中断的原因。
2.  处理异常/中断。

当异常/中断被处理后，内核执行以下步骤:

1.  选择要恢复的进程。
2.  恢复选定进程的上下文。
3.  恢复所选进程的执行。

在任何时间点，中央处理器中所有寄存器的值定义了中央处理器的上下文。CPU 上下文使用的另一个名称是 CPU 状态。

异常/中断处理程序使用与当前正在执行的进程相同的中央处理器。当进入异常/中断处理程序时，异常/中断处理程序使用的所有中央处理器寄存器中的值必须保存到内存中。保存的寄存器值可以在以后恢复执行过程之前恢复。

处理程序被调用的原因可能有很多。因此，处理程序需要确定异常或中断的原因。导致异常或中断的信息可以存储在专用寄存器或内存中的预定义地址。

接下来，需要服务异常或中断。例如，如果是键盘中断，则获取按键的键码并存储在某个地方，或者采取一些其他适当的动作。如果是算术溢出异常，可能会打印错误消息或终止程序。

异常/中断现在已经被处理，内核。内核可以选择恢复在处理异常/中断之前执行的相同进程，或者恢复当前在内存中的任何其他进程的执行。

现在可以通过从内存中读取和恢复所有寄存器值来恢复所选进程的 CPU 上下文。

选择恢复的进程必须在停止的同一时间点恢复。该指令的地址在中断发生时由机器保存，因此只需获取该地址并使 CPU 继续在该地址执行即可。