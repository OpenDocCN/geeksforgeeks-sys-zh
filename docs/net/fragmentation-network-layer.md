# 网络层碎片

> 原文:[https://www.geeksforgeeks.org/fragmentation-network-layer/](https://www.geeksforgeeks.org/fragmentation-network-layer/)

先决条件–[IP v4 数据报分段和延迟](https://www.geeksforgeeks.org/network-layer-ipv4-datagram-fragmentation-and-delays/)

**当数据报的最大大小大于一个帧中可以容纳的数据的最大大小，即其最大传输单元(MTU)时，网络层会进行分段**。网络层将从传输层接收的数据报分成多个片段，这样数据流就不会中断。

*   由于 IP 报头中总长度为 16 位，因此 IP 数据报的最大大小= 2<sup>16</sup>–1 = 65，535 字节。

*   它由目的端的网络层完成，通常在路由器上完成。
*   由于传输层的明智(良好)分段，源端不需要分段，即传输层查看数据报数据限制和帧数据限制，而不是在传输层进行分段和在网络层进行分段，并且以这样一种方式进行分段，使得结果数据可以容易地适合帧而不需要分段。
*   接收器通过 IP 报头中的**标识(16 位)**字段来识别帧。帧的每个片段都有相同的标识号。
*   接收器使用 IP 报头中的**片段偏移量(13 位)**字段来识别帧序列
*   由于碎片化引入的额外报头，网络层存在开销。

### IP 报头中用于分段的字段–

*   **标识(16 位)–**用于标识同一帧的片段。
*   **片段偏移量(13 位)–**用于识别帧中的片段序列。它通常指示片段之前或之前的数据字节数。
    可能的最大片段偏移量=(65535–20)= 65515
    {其中 65535 是数据报的最大大小，20 是 IP 报头的最小大小}
    因此，我们需要 ceil(log <sub>2</sub> 65515) = 16 位作为片段偏移量，但片段偏移量字段只有 13 位。因此，为了高效地表示，我们需要将片段偏移字段缩小 2 <sup>16</sup> /2 <sup>13</sup> = 8，作为一个缩放因子。因此，除最后一个片段之外的所有片段都应该具有 8 的倍数的数据，以便片段偏移∈ N
*   **更多片段(MF = 1 位)–**告知是否有更多片段在此片段前面，即如果 MF = 1，则有更多片段在此片段前面，如果 MF = 0，则为最后一个片段。
*   **不分段(DF = 1 位)–**如果我们不希望数据包被分段，则设置 DF，即 DF = 1。

### 碎片的重新组装–

它只发生在目的地，而不发生在路由器，因为数据包采取独立的路径(数据报包交换)，所以所有可能不会在路由器相遇，因此可能会再次出现碎片的需要。碎片也可能会无序到达。

![](img/23641ae1fb304cf9c610c8b8462f9840.png)

#### 算法–

1.  目的地应标识数据报是从 MF 分段的，分段偏移字段。
2.  目的地应该从标识字段中识别属于同一数据报的所有片段。
3.  识别第一个片段(偏移量= 0)。
4.  使用报头长度、片段偏移量识别后续片段。
5.  重复，直到 MF = 0。

#### 效率–

```
Efficiency (e) = useful/total = (Data without header)/(Data with header) 

Throughput = e * B { where B is bottleneck bandwidth } 
```

**示例–**最大传输单元(MTU)为 200 字节的 IP 路由器收到一个大小为 520 字节的 IP 数据包，其 IP 报头长度为 20 字节。IP 报头中相关字段的值。

**说明–**由于 MTU 为 200 字节，20 字节为报头大小 so，数据最大长度= 180 字节，但由于不能被 8 整除，因此不能用片段偏移量表示，因此数据最大可行长度= 176 字节。
碎片数= (520/200) = 3。
报头长度= 5(因为比例因子为 4，所以 20/4 = 5)
效率，e =(无报头的数据)/(有报头的数据)= 500/560 = 89.2 %

![](img/1ca235b8392f7161e8e8b9fba66a1da5.png)

**GATE 练习题–**

1.  [GATE CS 2013 |第 65 题](https://www.geeksforgeeks.org/gate-gate-cs-2013-question-37/)
2.  [GATE-CS-2014-(Set-3) |第 38 题](https://www.geeksforgeeks.org/gate-gate-cs-2014-set-3-question-38/)
3.  [GATE-CS-2015(第 2 集)|第 65 题](https://www.geeksforgeeks.org/gate-gate-cs-2015-set-2-question-62/)
4.  [GATE-CS-2016(第 1 集)|第 63 题](https://www.geeksforgeeks.org/gate-gate-cs-2016-set-1-question-63/)
5.  [cs 2018 门|问题 37](https://www.geeksforgeeks.org/gate-gate-cs-2018-question-37/)