# 傻窗综合征

> 原文:[https://www.geeksforgeeks.org/silly-window-syndrome/](https://www.geeksforgeeks.org/silly-window-syndrome/)

**傻窗综合征**是由于 [TCP](https://www.geeksforgeeks.org/computer-network-tcp-congestion-control/) 实现不佳而出现的问题。它降低了 TCP 的性能，使数据传输效率极低。之所以这么叫问题，是因为:

1.  它导致发送方窗口大小缩小到一个愚蠢的值。

2.  窗口大小缩小到传输的数据小于传输控制协议报头的程度。

**原因是什么？**
该综合征的两大病因如下:

1.  发送方窗口重复发送一个字节的数据。

2.  接收器窗口重复接受一个字节的数据。

**原因-1:** 发送方窗口重复传输一个字节的数据–
假设一个应用程序只生成一个字节的数据。TCP 的不良实现导致传输这一小部分数据。每次应用程序生成一个字节的数据，窗口都会传输它。这使得传输过程缓慢且低效。用 Nagle 算法解决了这个问题。

**Nagle 的算法建议:**

1.  当从应用程序接收到一个字节的数据时，发送方应该只发送第一个字节。

2.  发送方应该缓冲所有剩余字节，直到未完成的字节得到确认。

3.  换句话说，发送者应该等待 1 RTT(往返时间)。

收到确认后，发送方应在一个 TCP 段中发送缓冲的数据。然后，发送方应该再次缓冲数据，直到之前发送的数据得到确认。

**原因-2:** 接收器窗口重复接受一个字节的数据–
假设考虑接收器无法处理所有传入数据的情况。在这种情况下，接收器将广告小窗口大小。该过程继续，窗口大小变得越来越小。当一个阶段重复通告 1 字节的窗口大小时，它就到达了。这使得接收过程缓慢且低效。这个问题的解决方案就是克拉克的解决方案。

**克拉克的解决方案建议:**

1.  接收器不应发送 1 字节的窗口更新。

2.  接收器应该等待，直到它有足够的下降空间。

3.  然后，接收者应该向发送者通告该窗口大小。

**注:**

1.  对于那些需要立即发送数据的应用程序，Nagle 的算法被关闭。Nagle 的算法会引入延迟，因为它每次往返只发送一个数据段。

2.  纳格尔算法和克拉克算法都可以协同工作。两者相辅相成。

**例:**
一个快速打字员一分钟能打 100 个字，每个字平均 6 个字。演示 Nagle 的算法，展示一个客户端和一个服务器之间的 TCP 段交换序列。指示从客户端发送的每个数据段包含多少个字符。假设客户机和服务器在同一个局域网中，RTT 是 20 毫秒？

**Nagle 的算法建议:**
发送方应等待 1 RTT 后再发送数据。从 1 RTT 的应用层接收的数据量应该发送到接收器。

1 RTT 累积数据量，

```
= (600 characters / 1 minute) x 20 msec
= (600 characters / 60 sec) x 20 msec
= (10 characters / 103 msec) x 20 msec
= 0.2 characters 
```

从这里，我们观察到:
即使发送者等待 1 个 RTT，也不会产生一个字符。因此，发件人必须等到收到至少 1 个字符。然后，发送者在一个段中发送它。因此，每个片段将发送一个字符。假设 TCP 报头长度为 20 字节，每个数据段将发送 41 字节的数据。