# 计算机网络 NAT 打孔

> 原文:[https://www . geesforgeks . org/NAT-打洞-电脑-网络/](https://www.geeksforgeeks.org/nat-hole-punching-in-computer-network/)

先决条件–[网络地址转换(NAT)](https://www.geeksforgeeks.org/network-address-translation-nat/)

**什么是 NAT 打孔？**
NAT 下设备的主要限制或缺点是不能接受出站连接。如果有人试图这样做，网络地址转换会确保信息到达垃圾桶。这种限制被称为*打孔*的方法克服。在这种方法中，使用了一个 NAT 之外的节点，该节点有一个可公开访问的静态 IP，它被称为会合服务器。它用于在两个节点之间建立连接，这两个节点或者都位于不同的网络地址转换之后，或者都位于同一网络地址转换之后，或者一个位于网络地址转换之后，另一个不位于网络地址转换之后，或者位于多个网络地址转换之下的节点。

**是用来做什么的？**
由于世界上大多数计算机都支持某种网络地址转换，这种方法被广泛应用于 **P2P 架构**。P2P 网络的建立需要任意两个节点之间的直接连接。打洞是创建 P2P 网络时必须学习的最重要的概念。使用这个概念可以绕过网络防火墙。打孔非常安全，因为连接必须从两端开始，因此需要两个用户的同意。

**是怎么做到的？**
NAT 打孔的详细说明使用[传输控制协议(TCP)](https://www.geeksforgeeks.org/tcp-ip-model/) 、[用户数据报协议(UDP)](https://www.geeksforgeeks.org/user-datagram-protocol-udp/) ，以及针对[互联网控制消息协议(ICMP)](https://www.geeksforgeeks.org/internet-control-message-protocol-icmp/) 。本文阐述了冲孔的基本概念。

下面我们将讨论如何使用 NAT 打孔在两个节点之间建立连接。

1.  普通 NAT 后面的对等体
2.  不同国家的同行
3.  落后于**多个级别的 NATs**

网络地址转换打孔机的基本原理是，当想要相互连接的两个节点都向服务器发送消息时。服务器用彼此的 IP 地址和端口(端点)来响应两个节点。两个节点都试图通过向对方发送消息来建立连接。消息被接收方网络设备丢弃，但发送方网络设备记下消息发送到的地址，来自该地址的任何传入消息都将被视为对此消息的回复，并将被路由到源端点。两个节点再次尝试通过发送消息相互连接。但是现在消息被成功接收，因为 NAT 认为这个消息是对前一个(失败的)消息的回复。轰！建立连接并打孔。

**术语:**

*   **A :** 节点 1
*   **B :** 节点 2
*   **S :** 会合服务器

**步骤:**

1.  发送者请求连接到接收者
2.  s 将 A 的地址发送到 B and B 的地址
3.  向 B and B 发送垃圾消息向发送垃圾消息(两者都被各自的国家丢弃)
4.  重复步骤 3。
5.  连接已建立。

上面给出的 NAT 打孔方法可以用于任何情况，要么两个节点都在同一个 NAT 后面，要么两个节点都在不同的 NAT 后面，或者即使两个节点都在多个级别的 NAT 后面。

也许 NAT 打孔的唯一缺点是，总是需要一个静态 ip 的公共可达服务器。一种叫做 [pwnat](https://samy.pl/pwnat/) 的架构被提出来克服这个问题，但是 pwnat 只在两个节点中的任何一个不在 nat 后面的时候工作。