# 什么是服务器端模板注入？

> 原文:[https://www . geesforgeks . org/什么是服务器端模板注入/](https://www.geeksforgeeks.org/what-is-server-side-template-injection/)

服务器端模板提供了一种处理动态生成 HTML 代码的简单技术。尽管它们也可能成为 SSTI 的目标(服务器端模板注入)。

SSTs 允许开发人员直接在服务器上用自定义用户信息预填充网页。因此，在服务器内部发出所有请求通常比在浏览器和服务器之间进行额外的往返更快。它不同于客户端模板，在客户端模板中，浏览器通常会加载影响最终用户总体体验的模板。

功能丰富的网络应用程序通常将用户的输入嵌入到网络模板中，以便提供灵活的快捷方式和功能。这使得漏洞很容易被误认为是跨站点脚本。

**SST 的工作方式:**
web 框架动态创建 HTML 最常用的方法是使用模板。它包括 HTML 输出的静态部分，以及描述如何放置动态内容的语法。

这些模板系统对于可疑的模板作者是不安全的。例如，一个网站不应该允许其用户提供自己的模板，因为模板作者可以执行跨站点脚本攻击，并且他们还可以获得这些模板变量的属性，这些属性可能包含敏感数据。

然后这些模板引擎处理模板文件，模板文件支持将动态信息填充到网页中。当一个 [HTTP 请求](https://www.geeksforgeeks.org/http-request-methods-python-requests/)进来时，模板引擎生成 HTML 输出回复。

一些最常用的服务器端模板引擎是 Jinja2 或 Jinja、Freemaker、樱井真子、Velocity、Smarty、Tornado、石根、Twig、小胡子等。

**SSTI 的工作方式:**
当恶意用户被允许使用本机模板语法向模板中注入恶意负载，然后在服务器端执行时，就会发生 SSTI。

模板引擎旨在通过合并固定模板和动态数据来创建网页。当用户输入信息并将其直接连接到模板中，而不是将其传递到表单数据中时，就会发生 SSTI 攻击。它让恶意用户随意注入模板命令，这可能会扭曲模板引擎，通常情况下，它允许他们完全控制服务器。

例如，

```
Template = “UserName:” + Input
render(template)
```

*   在上面的例子中，“输入”是模板的一部分。因此，用户可以输入用户名或网络应用的其他参数，如一些任意代码。因此，用户可以输入类似。

```
Username: {{9*9}}  
Username 81
```

*   如上所述，SST 引擎处理输入{{9*9}}并给出 81 作为输出。这表明该 web 应用程序易受攻击。
*   如果发现 web 应用程序存在漏洞，攻击者甚至可以输入一些恶意代码来获得完全的远程访问权限。例如，

```
About:{{Malicious Code()}}
```

**SSTI 检测:**

SSTIs 可以通过纯文本检测方法或代码上下文检测方法来检测。

*   **纯文本检测方法–**
    纯文本检测可以用来检测 SSTIs，在这里面一些常用的模板表达式可以被测试者使用。

```
For example: {{8*5}}, ${2*7}, {{8/0}}, <%= 5/0 %>, ${foobar}, {{9*9}}, etc.  
```

*   **代码上下文检测–**
    在这种情况下，有效载荷可用于获取错误响应。例如，可以使用 [HTTP GET](https://www.geeksforgeeks.org/http-get-post-methods-php/) 参数在模板语句中插入变量。

```
For example: Greet_user = username
Hello user_x
```

*   如果有效载荷服务器的响应只是空白的“你好”。然后测试人员可以脱离模板语句并注入一个 HTML 标记。例如，

```
Greet_user = username
Hello
```

*   现在，注入 HTML 标签。

```
Greet_user = username}}<tag>
Hello user_x <tag>
```

**预防措施:**
服务器端模板注入的预防措施可以根据所使用的模板引擎而有所不同。尽管沙箱和清理可以用来防止此漏洞。

*   **沙箱–**
    它用于在网络上创建一个模拟最终用户操作环境的隔离测试环境，用户可以在其中运行、分析或观察代码。它可以避免威胁进入网络，还有助于检查不可信或未经测试的代码。
*   **净化–**
    模板不应该由用户控制的输入生成。用户应该仅通过使用模板参数将输入传递给模板。通过在解析信息之前消除不需要的和不安全的字符，在将输入传递到模板之前对其进行净化。这减少了对模板进行恶意调查的漏洞。