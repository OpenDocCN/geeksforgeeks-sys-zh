# 数据库管理系统中基于日志的恢复

> 原文:[https://www.geeksforgeeks.org/log-based-recovery-in-dbms/](https://www.geeksforgeeks.org/log-based-recovery-in-dbms/)

[原子性](https://www.geeksforgeeks.org/acid-properties-in-dbms/)DBMS 的属性声明要么必须执行事务的所有操作，要么不执行。中止的事务所做的修改不应该对数据库可见，提交的事务所做的修改应该可见。

为了实现原子性的目标，用户必须首先向稳定的存储输出描述修改的信息，而不修改数据库本身。这些信息可以帮助我们确保提交的事务执行的所有修改都反映在数据库中。这些信息还可以帮助我们确保中止的事务所做的任何修改都不会保留在数据库中。

**日志和日志记录–**
日志是一系列日志记录，记录了数据库中的所有更新活动。在稳定的存储中，会维护每个事务的日志。对数据库执行的任何操作都记录在日志中。在对数据库执行任何修改之前，会创建一个更新日志记录来反映该修改。

表示为:<ti xj="" v1="" v2="">的更新日志记录具有以下字段:</ti>

1.  **事务标识符:**执行写操作的事务的唯一标识符。
2.  **数据项:**写入的数据项的唯一标识符。
3.  **旧值:**写入前数据项的值。
4.  **新值:**写操作后数据项的值。

其他类型的日志记录有:

1.  **< Ti 开始>** :包含交易 Ti 何时开始的信息。
2.  **< Ti 提交>** :包含事务 Ti 何时提交的信息。
3.  **< Ti 中止>** :包含交易 Ti 何时中止的信息。

**撤消和重做操作–**
因为所有数据库修改之前必须创建日志记录，所以系统既有修改数据项之前的旧值，也有要为数据项写入的新值。这允许系统适当地执行重做和撤消操作:

1.  **撤销:**使用日志记录将日志记录中指定的数据项设置为旧值。
2.  **重做:**使用日志记录将日志记录中指定的数据项设置为新值。

**可以使用两种方法修改数据库–**

1.  **延迟修改技术:**如果事务直到部分提交后才修改数据库，则称其使用了延迟修改技术。
2.  **立即修改技术:**如果在事务仍处于活动状态时发生数据库修改，则称为使用立即修改技术。

**使用日志记录进行恢复–**
发生系统崩溃后，系统会参考日志来确定哪些事务需要重做，哪些需要撤消。

1.  如果日志包含记录<ti start="">但不包含记录<ti commit="">或记录<ti abort="">，则需要撤销事务 T1。</ti></ti></ti>
2.  如果日志包含记录<ti start="">和记录<ti commit="">或记录<ti abort="">，则需要重做事务 T1。</ti></ti></ti>

**检查点的使用–**
当系统崩溃时，用户必须查阅日志。原则上，需要搜索整个日志来确定这些信息。这种方法有两个主要困难:

1.  搜索过程非常耗时。
2.  根据我们的算法，大多数需要重做的事务已经将它们的更新写入了数据库。虽然重做它们不会造成伤害，但会导致恢复需要更长时间。

为了减少这些类型的开销，用户引入了检查点。表单<checkpoint l="">的日志记录用于表示日志中的检查点，其中 L 是检查点时活动的事务列表。当添加检查点日志记录来记录时，在该检查点之前提交的所有事务在检查点记录之前都有<ti commit="">日志记录。Ti 所做的任何数据库修改都将在检查点之前或作为检查点本身的一部分写入数据库。因此，在恢复时，不需要对 Ti 执行重做操作。</ti></checkpoint>

系统崩溃后，系统会检查日志以找到最后一条<checkpoint l="">记录。重做或撤消操作只需应用于 L 中的事务，以及记录写入日志后开始执行的所有事务。让我们将这组事务表示为 T。撤销和重做的相同规则适用于 T，如使用日志记录的恢复部分所述。</checkpoint>

请注意，用户只需要检查日志中从最后一个检查点日志记录开始的部分，就可以找到事务集 T，并找出对于 T 中的每个事务，日志中是否出现提交或中止记录。。。，T100}。假设最近的检查点发生在事务 T67 和 T69 的执行期间，而 T68 和下标低于 67 的所有事务都在检查点之前完成。因此，只有事务 T67、T69、.。。，在恢复方案期间需要考虑 T100。如果已经完成(即提交或中止)，则需要重做它们中的每一个；否则，它是不完整的，需要撤销。