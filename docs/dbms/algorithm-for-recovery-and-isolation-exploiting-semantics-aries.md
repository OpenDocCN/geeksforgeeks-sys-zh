# 利用语义的恢复和隔离算法(ARIES)

> 原文:[https://www . geeksforgeeks . org/算法恢复和隔离利用语义-aries/](https://www.geeksforgeeks.org/algorithm-for-recovery-and-isolation-exploiting-semantics-aries/)

利用语义的恢复和隔离算法是基于提前写日志协议的。每次更新操作都会写入一条[日志记录](https://www.geeksforgeeks.org/log-based-recovery-in-dbms/)，该记录为以下内容之一:

1.  **仅撤销日志记录:**
    仅记录之前的图像。因此，可以执行撤消操作来检索旧数据。
2.  **仅重做日志记录:**
    仅记录后映像。因此，可以尝试重做操作。
3.  **撤销-重做日志记录:**
    记录图像之前和图像之后。

其中，每个日志记录都被分配一个唯一且单调递增的日志序列号(LSN)。每个数据页面都有一个页面 LSN 字段，该字段被设置为日志记录的 LSN，对应于页面上的最后一次更新。WAL 要求对应于更新的日志记录在对应于该更新的数据页被写入磁盘之前，使其稳定存储。出于性能原因，每次日志写入都不会立即强制写入磁盘。日志尾保留在主内存中，用于缓冲日志写入。日志尾变满时会刷新到磁盘。在提交日志记录到达磁盘之前，不能声明提交事务。

恢复子系统偶尔会将检查点记录写入日志。检查点记录包含事务表和脏页表。主日志记录在稳定存储中单独维护，以存储最新检查点记录的 LSN，该记录已写入磁盘。重启时，恢复子系统读取主日志记录以找到检查点的 LSN，读取检查点记录，并从那里开始恢复。

恢复过程实际上包括 3 个阶段:

1.  **分析:**
    恢复子系统确定最早的日志记录，下一轮必须从该记录开始。它还从检查点记录向前扫描日志，以构建系统崩溃瞬间的快照。
2.  **重做:**
    从最早的 LSN 开始，日志向前读，每次更新重做。
3.  **撤销:**
    日志被向后扫描，对应于失败者事务的更新被撤销。